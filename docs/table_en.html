<!DOCTYPE html>
<html lang="en">
<head>
    <link href="logo.png" rel="icon"/>
    <meta charset="UTF-8">
    <title>Oct7 Database Viewer</title>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- jQuery UI for resizable -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <!-- PapaParse for CSV parsing -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #ede0d4;
        }
        #filters { margin-bottom: 20px; }
        label { margin-right: 10px; }
        .logo-topright {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            border-radius: 10px;
            z-index: 10;
        }
        #oct7table td {
            max-width: 15ch;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        #oct7table th {
            position: relative;
            position: sticky;
            top: 0;
            background-color: #ede0d4;
            z-index: 10;
        }
        #oct7table th:nth-child(1),
        #oct7table th:nth-child(2),
        #oct7table th:nth-child(3) {
            z-index: 11;
        }
        #oct7table td:nth-child(1) {
            position: sticky;
            left: 0;
            background-color: #ede0d4;
            z-index: 1;
        }
        #oct7table td:nth-child(2) {
            position: sticky;
            left: 0;
            background-color: #ede0d4;
            z-index: 1;
        }
        #oct7table td:nth-child(3) {
            position: sticky;
            left: 0;
            background-color: #ede0d4;
            z-index: 1;
        }
        .resizer {
            position: absolute;
            top: 0;
            right: 0;
            width: 10px;
            cursor: col-resize;
            user-select: none;
            height: 100%;
            z-index: 1000;
            background: transparent;
        }
        .resizer:hover {
            background-color: rgba(76, 175, 80, 0.5);
        }
    </style>
</head>
<body>
        <img src="logo.png" alt="oct7database logo" class="logo-topright">
        <h2>October 7 Database</h2>
        <span>
            <a href="https://oct7database.com" target="_blank">oct7database.com</a>
            <button style="margin-left:10px;vertical-align:middle;" onclick="window.open('table.html', '_blank')">Hebrew</button>
            <button id="resetButton" style="margin-left:10px;vertical-align:middle;">Reset</button>
        </span><br><br>
    <div id="filters"></div>
    <table id="oct7table" class="display" style="width:100%">
        <thead></thead>
        <tbody></tbody>
    </table>
    <div id="map-container" style="display:none; margin-top:20px;">
        <iframe id="map-iframe" width="100%" height="800" frameborder="0" style="border:0"></iframe>
    </div>
    <script>
    // First load the location dictionary for Residence translations
    var residenceTranslations = {};
    
    // Fallback translations for common Israeli cities/places not in dictionary
    var fallbackTranslations = {
        'אבו סנאן': 'Abu Sinan',
        'אבו רובעייה': 'Abu Rubeiya',
        'אבו תלול': 'Abu Tulul',
        'אבטין': 'Avtin',
        'אבני איתן': 'Avnei Eitan',
        'אבן יהודה': 'Even Yehuda',
        'אבן שמואל': 'Even Shmuel',
        'אדרת': 'Aderet',
        'אודם': 'Odem',
        'אוהד': 'Ohad',
        'אוקראינה': 'Ukraine',
        'אורה': 'Ora',
        'אורטל': 'Ortal',
        'אור יהודה': 'Or Yehuda',
        'אורנית': 'Oranit',
        'אור עקיבא': 'Or Akiva',
        'אזור': 'Area',
        'אחוזת ברק': 'Ahuzat Barak',
        'איילת השחר': 'Ayelet HaShahar',
        'איכסאל': 'Iksal',
        'אילינוי ארה״ב': 'Illinois, USA',
        'אילת': 'Eilat',
        'אירוס': 'Irus',
        'איתמר': 'Itamar',
        'איתן': 'Eitan',
        'אלון': 'Alon',
        'אלון שבות': 'Alon Shvut',
        'אליכין': 'Elyakhin',
        'אלמוג': 'Almog',
        'אלעזר': 'Elazar',
        'אלפי מנשה': 'Alfei Menashe',
        'אלקוש': 'Elkosh',
        'אפיק': 'Afik',
        'אפיקים': 'Afikim',
        'אפרת': 'Efrat',
        'ארז': 'Erez',
        'אריאל': 'Ariel',
        'אשדוד': 'Ashdod',
        'אשחר': 'Eshar',
        'באר יעקב': 'Be\'er Ya\'akov',
        'באר מילכה': 'Be\'er Milka',
        'בני אדם': 'Benei Adam',
        'בני דקלים': 'Benei Dekalim',
        'בנימינה': 'Binyamina',
        'בנימינה גבעת עדה': 'Binyamina-Giv\'at Ada',
        'בסמת טבעון': 'Basmat Tab\'un',
        'בענה': 'Ba\'ana',
        'בצרה': 'Batzra',
        'בקעות': 'Beka\'ot',
        'ברור חיל': 'Bror Hayil',
        'ברכיה': 'Berekhya',
        'ברעם': 'Bar\'am',
        'בת עין': 'Bat Ayin',
        'בת חן': 'Bat Chen',
        'גבע': 'Geva',
        'גבע בנימין': 'Giv\'a Binyamin',
        'גבעון': 'Givon',
        'גבעות': 'Geva\'ot',
        'גבעות בר': 'Giv\'ot Bar',
        'גבעת אבני': 'Giv\'at Avni',
        'גבעת אלה': 'Giv\'at Ela',
        'גבעת ברנר': 'Giv\'at Brenner',
        'גבעת הראל': 'Giv\'at HaRe\'el',
        'גבעת זאב': 'Giv\'at Ze\'ev',
        'גבעת חיים איחוד': 'Giv\'at Haim Ihud',
        'גבעת חיים מאוחד': 'Giv\'at Haim Me\'uhad',
        'גבעתי': 'Givati',
        'גבעתיים': 'Givatayim',
        'גבעת שמואל': 'Giv\'at Shmuel',
        'גבעת שפירא': 'Giv\'at Shapira',
        'גדרה': 'Gedera',
        'גילון': 'Gilon',
        'גן אורון': 'Gan Oron',
        'גני תקווה': 'Ganei Tikva',
        'גן שורק': 'Gan Sorek',
        'דבורה': 'Devora',
        'דבוריה': 'Daburiyya',
        'דימונה': 'Dimona',
        'דליה': 'Daliyya',
        'דלית אל כרמל': 'Daliyat al-Karmel',
        'דמיידה': 'Dumayda',
        'הודיה': 'Hodaya',
        'הוד השרון': 'Hod HaSharon',
        'חבצלת השרון': 'Havatzelet HaSharon',
        'חולדה': 'Hulda',
        'חולית': 'Holit',
        'חיבת ציון': 'Hibat Zion',
        'חמרה': 'Hamra',
        'חניאל': 'Haniel',
        'חניתה': 'Hanita',
        'חספין': 'Haspin',
        'חצב': 'Hatzav',
        'חצור': 'Hatzor',
        'חצרים': 'Hatzerim',
        'טבריה': 'Tiberias',
        'טורעאן': 'Tur\'an',
        'טירה': 'Tayibe',
        'יבנה': 'Yavne',
        'יבניאל': 'Yavne\'el',
        'יהוד': 'Yehud',
        'יהוד מונוסון': 'Yehud-Monosson',
        'יהל': 'Yahel',
        'יובלים': 'Yuvalim',
        'יוקנעם': 'Yokne\'am',
        'יושיביה': 'Yoshivya',
        'יזרעאל': 'Yizre\'el',
        'יטבתה': 'Yotvata',
        'ימית': 'Yamit',
        'יסוד המעלה': 'Yesod HaMa\'ala',
        'יעד': 'Ya\'ad',
        'יערה': 'Ya\'ara',
        'יפיע': 'Yafa',
        'יפעת': 'Yifat',
        'יצהר': 'Yitzhar',
        'ירדן': 'Jordan',
        'ירושלים': 'Jerusalem',
        'ירכא': 'Yarka',
        'כאבול': 'Kabul',
        'כוכב השחר': 'Kokhav HaShahar',
        'כוכב יאיר': 'Kokhav Ya\'ir',
        'כוכב מיכאל': 'Kokhav Michael',
        'כחל': 'Kahal',
        'כיסרא': 'Kisra',
        'כליל': 'Klil',
        'כנות': 'Kanot',
        'כסיפה': 'Kseifa',
        'כפר אביב': 'Kfar Aviv',
        'כפר אדומים': 'Kfar Adumim',
        'כפר אוריה': 'Kfar Uriya',
        'כפר ביל"ו': 'Kfar Bilu',
        'כפר ביאליק': 'Kfar Bialik',
        'כפר בלום': 'Kfar Blum',
        'כפר בן נון': 'Kfar Bin Nun',
        'כפר גליקסון': 'Kfar Glickson',
        'כפר גלעדי': 'Kfar Gil\'adi',
        'כפר דניאל': 'Kfar Daniel',
        'כפר החורש': 'Kfar HaHoresh',
        'כפר המכבי': 'Kfar HaMaccabi',
        'כפר הנגיד': 'Kfar HaNagid',
        'כפר הנשיא': 'Kfar HaNasi',
        'כפר הס': 'Kfar Hess',
        'כפר ויתקין': 'Kfar Vitkin',
        'כפר זיתים': 'Kfar Zeitim',
        'כפר חב"ד': 'Kfar Chabad',
        'כפר חושן': 'Kfar Hoshen',
        'כפר חיטים': 'Kfar Hittim',
        'כפר יהושע': 'Kfar Yehoshua',
        'כפר ינאי': 'Kfar Yona',
        'כפר יעבץ': 'Kfar Ya\'abetz',
        'כפר כמא': 'Kafr Kama',
        'כפר מימון': 'Kfar Maimon',
        'כפר מנדא': 'Kafr Manda',
        'כפר מנחם': 'Kfar Menahem',
        'כפר מצר': 'Kafr Misr',
        'כפר מרדכי': 'Kfar Mordechai',
        'כפר נטר': 'Kfar Netter',
        'כפר סבא': 'Kfar Saba',
        'כפר סילבר': 'Kfar Silver',
        'כפר סירקין': 'Kfar Sirkin',
        'כפר עבודה': 'Kfar Avoda',
        'כפר עציון': 'Kfar Etzion',
        'כפר קאסם': 'Kafr Qasim',
        'כפר קיש': 'Kfar Kisch',
        'כפר קרע': 'Kafr Qara',
        'כפר רופין': 'Kfar Ruppin',
        'כפר רות': 'Kfar Ruth',
        'כפר שמאי': 'Kfar Shamai',
        'כפר שמואל': 'Kfar Shmuel',
        'כפר תבור': 'Kfar Tavor',
        'כרמאל': 'Karme\'el',
        'כרמיאל': 'Karmi\'el',
        'לבון': 'Lavon',
        'לביא': 'Lavi',
        'להב': 'Lahav',
        'להבים': 'Lehavim',
        'לוד': 'Lod',
        'לימן': 'Liman',
        'מאור': 'Ma\'or',
        'מבוא דותן': 'Mevo Dotan',
        'מבוא חורון': 'Mevo Horon',
        'מבוא מודיעים': 'Mevo Modi\'im',
        'מבועים': 'Mevo\'im',
        'מבשרת ציון': 'Mevasseret Zion',
        'מגדל': 'Migdal',
        'מגדל העמק': 'Migdal HaEmek',
        'מגדלים': 'Migdalim',
        'מגן': 'Magen',
        'מודיעין': 'Modi\'in',
        'מודיעין עילית': 'Modi\'in Illit',
        'מודיעין מכבים רעות': 'Modi\'in-Maccabim-Re\'ut',
        'מולדת': 'Moledet',
        'מזכרת בתיה': 'Mazkeret Batya',
        'מטולה': 'Metula',
        'מיתר': 'Meitar',
        'מכחול': 'Makhol',
        'מכמורת': 'Mikhmoret',
        'מלילות': 'Melilot',
        'מנוף': 'Manof',
        'מנות': 'Manot',
        'מנחמיה': 'Menhamya',
        'מסעדה': 'Mas\'ada',
        'מעלה אדומים': 'Ma\'ale Adumim',
        'מעלה אפרים': 'Ma\'ale Efraim',
        'מעלה גלבוע': 'Ma\'ale Gilboa',
        'מעלה החמישה': 'Ma\'ale HaHamisha',
        'מעלה מכמש': 'Ma\'ale Mikhmas',
        'מעלה עמוס': 'Ma\'ale Amos',
        'מעש': 'Ma\'as',
        'מצד': 'Metzad',
        'מצובה': 'Matzuva',
        'מצפה נטופה': 'Mitzpe Netofa',
        'מצפה רמון': 'Mitzpe Ramon',
        'מצר': 'Matzor',
        'מקווה ישראל': 'Mikveh Israel',
        'מרחב עם': 'Merhav Am',
        'משאבי שדה': 'Mash\'abei Sadeh',
        'משגב דב': 'Misgav Dov',
        'משגב עם': 'Misgav Am',
        'משואה': 'Massu\'a',
        'משואות יצחק': 'Massu\'ot Yitzhak',
        'משמר איילון': 'Mishmar Ayalon',
        'משמר דוד': 'Mishmar David',
        'משמר הנגב': 'Mishmar HaNegev',
        'משמר העמק': 'Mishmar HaEmek',
        'משמר השבעה': 'Mishmar HaShiv\'a',
        'משמר השרון': 'Mishmar HaSharon',
        'משמרת': 'Mishmeret',
        'מתן': 'Mattan',
        'מתת': 'Metat',
        'נאות גולן': 'Ne\'ot Golan',
        'נאות הכיכר': 'Ne\'ot HaKikar',
        'נאות מרדכי': 'Ne\'ot Mordehai',
        'נאות סמדר': 'Ne\'ot Smadar',
        'נבטים': 'Nevatim',
        'נהלל': 'Nahalal',
        'נהרייה': 'Nahariya',
        'נוב': 'Nov',
        'נועם': 'No\'am',
        'נוף איילון': 'Nof Ayalon',
        'נוף הגליל': 'Nof HaGalil',
        'נופים': 'Nofim',
        'נופית': 'Nofit',
        'נוקדים': 'Nokdim',
        'נורדיה': 'Nordiya',
        'נטור': 'Natur',
        'ניצן': 'Nitzan',
        'ניצנה': 'Nitzana',
        'ניצני סיני': 'Nitzanei Sinai',
        'ניר אליהו': 'Nir Eliyahu',
        'ניר בנים': 'Nir Banim',
        'ניר גלים': 'Nir Gallim',
        'ניר דוד': 'Nir David',
        'ניר חן': 'Nir Hen',
        'ניר יפה': 'Nir Yafe',
        'ניר ישראל': 'Nir Yisrael',
        'ניר משה': 'Nir Moshe',
        'ניר עם': 'Nir Am',
        'ניר עציון': 'Nir Etzion',
        'ניר צבי': 'Nir Tzvi',
        'נס הרים': 'Nes Harim',
        'נס עמים': 'Nes Ammim',
        'נס ציונה': 'Ness Ziona',
        'נעורים': 'Ne\'urim',
        'נעלה': 'Na\'ale',
        'נעמה': 'Ne\'ama',
        'נען': 'Na\'an',
        'נצרת': 'Nazareth',
        'נצרת עילית': 'Nof HaGalil',
        'נשר': 'Nesher',
        'נתיב הגדוד': 'Netiv HaGdud',
        'נתיב הל"ה': 'Netiv HaLamed-Heh',
        'נתיב השיירה': 'Netiv HaShayara',
        'נתיבות': 'Netivot',
        'סאג\'ור': 'Sajur',
        'סאסא': 'Sasa',
        'סביון': 'Savyon',
        'סואעד חמרה': 'Suaed Hamra',
        'סולם': 'Sulam',
        'סוסיה': 'Susya',
        'סח\'נין': 'Sakhnin',
        'סייד': 'Seid',
        'סלמה': 'Salama',
        'סנסנה': 'Sansana',
        'סעד': 'Sa\'ad',
        'סעוה': 'Sa\'wa',
        'ספיר': 'Sapir',
        'עדי': 'Adi',
        'עדנה': 'Adena',
        'עוזה': 'Uza',
        'עוזיאל': 'Uziel',
        'עולש': 'Ulash',
        'עומר': 'Omer',
        'עופר': 'Ofer',
        'עופרה': 'Ofra',
        'עוצם': 'Otzem',
        'עין איילה': 'Ein Ayala',
        'עין אל אסד': 'Ein al-Asad',
        'עין גב': 'Ein Gev',
        'עין גדי': 'Ein Gedi',
        'עין דור': 'Ein Dor',
        'עין הבשור': 'Ein HaBesor',
        'עין הוד': 'Ein Hod',
        'עין החורש': 'Ein HaHoresh',
        'עין המפרץ': 'Ein HaMifratz',
        'עין הנצי"ב': 'Ein HaNatziv',
        'עין העמק': 'Ein HaEmek',
        'עין השופט': 'Ein HaShofet',
        'עין ורד': 'Ein Vered',
        'עין זיוון': 'Ein Zivan',
        'עין חוד': 'Ein Hod',
        'עין חצבה': 'Ein Hatzeva',
        'עין יהב': 'Ein Yahav',
        'עין כרם': 'Ein Kerem',
        'עין כרמל': 'Ein Carmel',
        'עין מאהל': 'Ein Mahil',
        'עין נקובא': 'Ein Nakuba',
        'עין עירון': 'Ein Iron',
        'עין צורים': 'Ein Tzurim',
        'עין קנייא': 'Ein Qiniyye',
        'עין ראפה': 'Ein Rafa',
        'עין שמר': 'Ein Shemer',
        'עין שריד': 'Ein Sarid',
        'עין תמר': 'Ein Tamar',
        'עיר אובות': 'Ir Ovot',
        'עכו': 'Acre',
        'עלי': 'Eli',
        'עלי זהב': 'Eli Zahav',
        'עלמה': 'Alma',
        'עלמון': 'Almon',
        'עמוקה': 'Amuqa',
        'עמיחי': 'Amichai',
        'עמיעד': 'Amiad',
        'עמיעוז': 'Amioz',
        'עמינדב': 'Aminadav',
        'עמיר': 'Amir',
        'עמיקם': 'Amiqam',
        'עמנואל': 'Immanuel',
        'עמקה': 'Amka',
        'ענתות': 'Anatot',
        'עספיא': 'Isfiya',
        'עפולה': 'Afula',
        'עץ אפרים': 'Etz Efraim',
        'עראבה': 'Arraba',
        'ערד': 'Arad',
        'ערוגות': 'Arugot',
        'ערערה': 'Ar\'ara',
        'עשרת': 'Aseret',
        'עתלית': 'Atlit',
        'עתניאל': 'Otniel',
        'פארן': 'Paran',
        'פדואל': 'Peduel',
        'פדויים': 'Peduyim',
        'פדיה': 'Pedaya',
        'פוריה': 'Poriya',
        'פוריידיס': 'Fureidis',
        'פורת': 'Porat',
        'פטיש': 'Patish',
        'פלך': 'Pelekh',
        'פלמחים': 'Palmahim',
        'פני חבר': 'Pnei Hever',
        'פסגות': 'Psagot',
        'פסוטה': 'Fasuta',
        'פעמי תשז': 'Pa\'amei Tashaz',
        'פצאל': 'Petza\'el',
        'פקיעין': 'Peki\'in',
        'פרדס חנה כרכור': 'Pardes Hanna-Karkur',
        'פרדסיה': 'Pardesiya',
        'פרזון': 'Perazon',
        'פתח תקווה': 'Petah Tikva',
        'פתחיה': 'Petahya',
        'צאלים': 'Tze\'elim',
        'צביה': 'Tzeviya',
        'צבעון': 'Tziv\'on',
        'צובה': 'Tzova',
        'צוחר': 'Tzohar',
        'צופיה': 'Tzofia',
        'צופים': 'Tzofim',
        'צופית': 'Tzofit',
        'צופר': 'Tzofer',
        'צוקי ים': 'Tzukei Yam',
        'צוקים': 'Tzukim',
        'צור הדסה': 'Tzur Hadassa',
        'צור יצחק': 'Tzur Yitzhak',
        'צור משה': 'Tzur Moshe',
        'צור נתן': 'Tzur Natan',
        'צוריאל': 'Tzuriel',
        'ציפורי': 'Tzippori',
        'צפריה': 'Tzafriya',
        'צפרירים': 'Tzafririm',
        'צפת': 'Safed',
        'קבועה': 'Kevu\'a',
        'קדומים': 'Kedumim',
        'קדימה צורן': 'Kadima-Zoran',
        'קדמה': 'Kadma',
        'קדמת צבי': 'Kidmat Tzvi',
        'קדר': 'Kedar',
        'קדרון': 'Kidron',
        'קדרים': 'Kedarim',
        'קודייראת א-צאנע': 'Qudeirat a-Sani',
        'קוממיות': 'Komeimiyut',
        'קורנית': 'Kornit',
        'קטורה': 'Ketura',
        'קיסריה': 'Caesarea',
        'קליה': 'Kalia',
        'קלנסווה': 'Qalansawe',
        'קלע': 'Kela',
        'קציר': 'Katzir',
        'קצר א-סר': 'Qasr a-Sir',
        'קצרין': 'Katzrin',
        'קרית אונו': 'Kiryat Ono',
        'קרית ארבע': 'Kiryat Arba',
        'קרית אתא': 'Kiryat Ata',
        'קרית ביאליק': 'Kiryat Bialik',
        'קרית גת': 'Kiryat Gat',
        'קרית טבעון': 'Kiryat Tiv\'on',
        'קרית ים': 'Kiryat Yam',
        'קרית יערים': 'Kiryat Ye\'arim',
        'קרית מוצקין': 'Kiryat Motzkin',
        'קרית מלאכי': 'Kiryat Malakhi',
        'קרית נטפים': 'Kiryat Netafim',
        'קרית עקרון': 'Kiryat Ekron',
        'קרית שמונה': 'Kiryat Shmona',
        'קרני שומרון': 'Karnei Shomron',
        'קשת': 'Keshet',
        'ראמה': 'Rama',
        'ראש העין': 'Rosh HaAyin',
        'ראש פינה': 'Rosh Pinna',
        'ראש צורים': 'Rosh Tzurim',
        'רבדים': 'Revadim',
        'רביבים': 'Revivim',
        'רביד': 'Ravid',
        'רגבה': 'Regavim',
        'רגבים': 'Regavim',
        'רהט': 'Rahat',
        'רווחה': 'Revaha',
        'רוויה': 'Revaya',
        'רוח מדבר': 'Ruah Midbar',
        'רוחמה': 'Ruhama',
        'רומאנה': 'Rumana',
        'רומת הייב': 'Rumat Heib',
        'רותם': 'Rotem',
        'רחובות': 'Rehovot',
        'רחלים': 'Rehelim',
        'ריחאניה': 'Rihaniya',
        'ריחן': 'Reihan',
        'ריינה': 'Reina',
        'רימונים': 'Rimonim',
        'רינתיה': 'Rinnatya',
        'רכסים': 'Rekhassim',
        'רם און': 'Ram-On',
        'רמות': 'Ramot',
        'רמות השבים': 'Ramot HaShavim',
        'רמות מאיר': 'Ramot Meir',
        'רמות מנשה': 'Ramot Menashe',
        'רמות נפתלי': 'Ramot Naftali',
        'רמלה': 'Ramla',
        'רמת גן': 'Ramat Gan',
        'רמת דוד': 'Ramat David',
        'רמת הכובש': 'Ramat HaKovesh',
        'רמת השופט': 'Ramat HaShofet',
        'רמת השרון': 'Ramat HaSharon',
        'רמת יוחנן': 'Ramat Yohanan',
        'רמת ישי': 'Ramat Yishai',
        'רמת מגשימים': 'Ramat Magshimim',
        'רמת צבי': 'Ramat Tzvi',
        'רמת רזיאל': 'Ramat Raziel',
        'רמת רחל': 'Ramat Rachel',
        'רנן': 'Renen',
        'רעים': 'Re\'im',
        'רעננה': 'Ra\'anana',
        'רקפת': 'Rakefet',
        'רשפון': 'Rishpon',
        'רתמים': 'Retamim',
        'שאר ישוב': 'She\'ar Yashuv',
        'שבי ציון': 'Shavei Tzion',
        'שבי שומרון': 'Shavei Shomron',
        'שבלי': 'Shibli',
        'שגב שלום': 'Segev Shalom',
        'שדה אילן': 'Sde Ilan',
        'שדה אליהו': 'Sde Eliyahu',
        'שדה אליעזר': 'Sde Eliezer',
        'שדה בוקר': 'Sde Boker',
        'שדה דוד': 'Sde David',
        'שדה וורבורג': 'Sde Warburg',
        'שדה יואב': 'Sde Yo\'av',
        'שדה יעקב': 'Sde Ya\'akov',
        'שדה יצחק': 'Sde Yitzhak',
        'שדה משה': 'Sde Moshe',
        'שדה נחום': 'Sde Nahum',
        'שדה ניצן': 'Sde Nitzan',
        'שדה עוזיהו': 'Sde Uziyahu',
        'שדה צבי': 'Sde Tzvi',
        'שדות ים': 'Sdot Yam',
        'שדות מיכה': 'Sdot Micha',
        'שדמה': 'Shadmot Mehola',
        'שדמות דבורה': 'Shadmot Devora',
        'שדרות': 'Sderot',
        'שהם': 'Shoham',
        'שואבה': 'Sho\'eva',
        'שובה': 'Shuva',
        'שובל': 'Shoval',
        'שוהם': 'Shoham',
        'שומרה': 'Shomera',
        'שומריה': 'Shomeriya',
        'שוקדה': 'Shokeda',
        'שורש': 'Shoresh',
        'שורשים': 'Shorashim',
        'שושנת העמקים': 'Shoshanat HaAmakim',
        'שזור': 'Shezor',
        'שחרות': 'Shaharut',
        'שיבולים': 'Shibbolim',
        'שיטים': 'Shittim',
        'שייח דנון': 'Sheikh Dannun',
        'שילה': 'Shilo',
        'שילת': 'Shilat',
        'שכניה': 'Shekhanya',
        'שלווה': 'Shalva',
        'שלוחות': 'Shluhot',
        'שלומי': 'Shlomi',
        'שלומית': 'Shlomit',
        'שמיר': 'Shamir',
        'שמעה': 'Shim\'a',
        'שמרת': 'Shameret',
        'שמשית': 'Shimshit',
        'שני': 'Shani',
        'שניר': 'Snir',
        'שעב': 'Sha\'av',
        'שעל': 'Sha\'al',
        'שעלבים': 'Sha\'alvim',
        'שער אפרים': 'Sha\'ar Efraim',
        'שער הגולן': 'Sha\'ar HaGolan',
        'שער העמקים': 'Sha\'ar HaAmakim',
        'שער מנשה': 'Sha\'ar Menashe',
        'שפיר': 'Shafir',
        'שפר': 'Shafer',
        'שפרעם': 'Shefa-Amr',
        'שקד': 'Shaked',
        'שקף': 'Shakaf',
        'שרונה': 'Sharona',
        'שריגים': 'Srigim',
        'שריד': 'Sarid',
        'שרשרת': 'Sharsheret',
        'תאילנד': 'Thailand',
        'תאשור': 'Ta\'ashur',
        'תדהר': 'Tidhar',
        'תובל': 'Tuval',
        'תומר': 'Tomer',
        'תושיה': 'Tushiya',
        'תימורים': 'Teimorim',
        'תירוש': 'Tirosh',
        'תל אביב': 'Tel Aviv',
        'תל אביב יפו': 'Tel Aviv-Yafo',
        'תל יוסף': 'Tel Yosef',
        'תל יצחק': 'Tel Yitzhak',
        'תל מונד': 'Tel Mond',
        'תל עדשים': 'Tel Adashim',
        'תל שבע': 'Tel Sheva',
        'תל תאומים': 'Tel Te\'omim',
        'תלם': 'Telem',
        'תלמי אליהו': 'Talme Eliyahu',
        'תלמי ביל"ו': 'Talme Bilu',
        'תלמי יוסף': 'Talme Yosef',
        'תלמי יחיאל': 'Talme Yehiel',
        'תלמי יפה': 'Talme Yafe',
        'תלמים': 'Telamim',
        'תמרת': 'Timrat',
        'תנובות': 'Tenubot',
        'תעוז': 'Ta\'oz',
        'תפרח': 'Tifrach',
        'תקומה': 'Tekuma',
        'תקוע': 'Tekoa',
        'תרום': 'Tarom',
        'נתניה': 'Netanya',
        'תל אביב-יפו': 'Tel Aviv-Yafo',
        'קריית אונו': 'Kiryat Ono',
        'קריית אתא': 'Kiryat Ata',


    };
    
    Papa.parse("https://raw.githubusercontent.com/yuval-harpaz/alarms/refs/heads/master/data/location_dictionary.csv", {
        download: true,
        header: true,
        complete: function(locationResults) {
            // Build residence translation map from Hebrew to English
            locationResults.data.forEach(function(row) {
                if (row.Hebrew && row.English) {
                    residenceTranslations[row.Hebrew] = row.English;
                }
            });
            
            // Add fallback translations
            for (var key in fallbackTranslations) {
                if (!residenceTranslations[key]) {
                    residenceTranslations[key] = fallbackTranslations[key];
                }
            }
            
            // Now load the main database
            loadMainData();
        }
    });
    
    function loadMainData() {
    // Load CSV and initialize DataTable
    Papa.parse("https://raw.githubusercontent.com/yuval-harpaz/alarms/refs/heads/master/data/oct7database.csv", {
        download: true,
        header: true,
        complete: function(results) {
            var data = results.data;
            var hideCols = ['שם פרטי', 'שם משפחה', 'שם נוסף', 'כינוי', 'מקום האירוע', 'מקום המוות', 'Event location class', 'Death location class'];
            var translations = {
                'front': 'Front',
                'Status': 'Status',
                'Role': 'Role',
                'Country': 'Country',
                'Gender': 'Gender',
                'Age': 'Age',
                'Party': 'Party',
                'Residence': 'Residence',
                'Event date': 'Event Date',
                'Death date': 'Death Date',
                'שם פרטי': 'First Name',
                'שם משפחה': 'Last Name',
                'שם נוסף': 'Middle Name',
                'כינוי': 'Nickname',
                'מקום האירוע': 'Event Location',
                'מקום המוות': 'Death Location',
                'סיבת המוות': 'Cause of Death',
                'הנצחה': 'Memorial',
                'הספריה הלאומית': 'National Library',
                // Role values
                'אזרח': 'Civilian',
                'חייל': 'Soldier',
                'כבאי': 'Firefighter',
                'כיתת כוננות': 'Emergency Squad',
                'צוות רפואי': 'Medical Team',
                'שב"כ': 'Shin Bet',
                'שוטר': 'Police',
                // Country values
                'אוקראינה': 'Ukraine',
                'ארה"ב': 'USA',
                'אריתריאה': 'Eritrea',
                'בריטניה': 'Britain',
                'גיאורגיה': 'Georgia',
                'גרמניה': 'Germany',
                'הודו': 'India',
                'הפיליפינים': 'Philippines',
                'טנזניה': 'Tanzania',
                'יוון': 'Greece',
                'ישראל': 'Israel',
                'מולדובה': 'Moldova',
                'מקסיקו': 'Mexico',
                'נפאל': 'Nepal',
                'סודן': 'Sudan',
                'סין': 'China',
                'סרי לנקה': 'Sri Lanka',
                'עזה': 'Gaza',
                'קמבודיה': 'Cambodia',
                'קנדה': 'Canada',
                'תאילנד': 'Thailand',
                // Gender values
                'F': 'Female',
                'M': 'Male',
                // Cause of Death values
                'הפגזת צה"ל': 'IDF Shelling',
                'נ.ט.': 'Anti-Tank',
                'פיגוע ירי': 'Shooting Attack',
                'ירי': 'Gunfire',
                'ירי בשוגג': 'Friendly Fire',
                'ירי צה"ל': 'IDF Fire',
                'פצמ"ר': 'Mortar',
                'רקטה': 'Rocket',
                'צלף': 'Sniper',
                'תאונה': 'Accident',
                'מטען': 'Explosive',
                'פיגוע דקירה': 'Stabbing Attack',
                'ירי בשוגג; כטב"מ ישראלי': 'Friendly Fire; Israeli Drone',
                'כטב"מ': 'Drone',
                'פיגוע סקילה': 'Stoning Attack',
                'פיגוע דריסה': 'Ramming Attack',
                'פיגוע': 'Attack',
                'פיגוע פטיש': 'Hammer Attack',
                'מיירט': 'Interceptor',
                'נפל': 'UXO',
                'פיגוע חטיפה': 'Kidnapping Attack',
                'פיצוץ רימון תקול': 'Grenade Malfunction',
                'נסיון חטיפה': 'Kidnapping Attempt'
            };
            var columns = Object.keys(data[0])
                .filter(function(col) { return hideCols.indexOf(col) === -1; })
                .map(function(col) {
                    return { title: translations[col] || col, data: col };
                });
            
            // Find the index of the pid column
            var pidColumnIndex = columns.findIndex(function(col) { return col.data === 'pid'; });

            // Build table header
            var thead = $("#oct7table thead");
            var headerRow = "<tr>";
            columns.forEach(function(col) { headerRow += "<th>" + col.title + "</th>"; });
            headerRow += "</tr>";
            thead.html(headerRow);

            // Build table body
            var tbody = $("#oct7table tbody");
            data.forEach(function(row) {
                var tr = "<tr>";
                columns.forEach(function(col) {
                    var cellData = row[col.data] || "";
                    // Convert Age to integer
                    if (col.data === 'Age' && cellData) {
                        var ageNum = parseInt(cellData);
                        cellData = isNaN(ageNum) ? '' : ageNum.toString();
                    }
                    // Translate Role values
                    if (col.data === 'Role' && cellData && translations[cellData]) {
                        cellData = translations[cellData];
                    }
                    // Translate Country values
                    if (col.data === 'Country' && cellData && translations[cellData]) {
                        cellData = translations[cellData];
                    }
                    // Translate Gender values
                    if (col.data === 'Gender' && cellData && translations[cellData]) {
                        cellData = translations[cellData];
                    }
                    // Translate Cause of Death values
                    if (col.data === 'סיבת המוות' && cellData && translations[cellData]) {
                        cellData = translations[cellData];
                    }
                    // Translate Residence values using location dictionary
                    if (col.data === 'Residence' && cellData && residenceTranslations[cellData]) {
                        cellData = residenceTranslations[cellData];
                    }
                    // Make links clickable in הנצחה column
                    if (col.data === 'הנצחה' && cellData && cellData.match(/https?:\/\/[^\s]+/)) {
                        cellData = cellData.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
                    }
                    // Make links for הספרייה הלאומית column
                    if (col.data === 'הספריה הלאומית' && cellData) {
                        cellData = '<a href="https://www.nli.org.il/he/authorities/' + cellData + '" target="_blank">' + cellData + '</a>';
                    }
                    tr += "<td>" + cellData + "</td>";
                });
                tr += "</tr>";
                tbody.append(tr);
            });

            // Initialize DataTable
            var table = $('#oct7table').DataTable({
                dom: 'lrt', // Hide default search box and length menu
                order: [],
                paging: false, // Show all rows, no pagination
                autoWidth: false
            });

            // Function to update sticky column positions
            function updateStickyColumns() {
                var col1Width = $('#oct7table th:nth-child(1)').outerWidth();
                var col2Width = $('#oct7table th:nth-child(2)').outerWidth();
                
                // For LTR: second column is at col1Width from left, third is at col1Width + col2Width
                $('#oct7table th:nth-child(2), #oct7table td:nth-child(2)').css('left', col1Width + 'px');
                $('#oct7table th:nth-child(3), #oct7table td:nth-child(3)').css('left', (col1Width + col2Width) + 'px');
            }

            // Add resize handles to columns
            setTimeout(function() {
                updateStickyColumns();
                $('#oct7table thead th').each(function() {
                    var $th = $(this);
                    var $resizer = $('<div class="resizer"></div>');
                    $th.append($resizer);
                    
                    $resizer.on('mousedown', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        var startX = e.pageX;
                        var startWidth = $th.outerWidth();
                        
                        $(document).on('mousemove.resize', function(e) {
                            e.preventDefault();
                            var width = startWidth + (e.pageX - startX);
                            if (width > 50) {
                                $th.css('width', width + 'px');
                                $th.css('min-width', width + 'px');
                                $th.css('max-width', width + 'px');
                            }
                        });
                        
                        $(document).on('mouseup.resize', function() {
                            $(document).off('mousemove.resize mouseup.resize');
                            updateStickyColumns();
                        });
                    });
                });
            }, 100);

            // Build filters for categorical columns and date range
            var filterHtml = '';
            var todayStr = new Date().toISOString().slice(0,10);
            var oct7Str = '2023-10-07';
            filterHtml += `<div id="search-row"><label>Free search: <input type="text" id="globalSearch" placeholder="Search all columns..."></label> `;
            columns.forEach(function(col, idx) {
                if (
                    data.length > 0 &&
                    !col.data.toLowerCase().includes('location class') &&
                    !col.data.toLowerCase().includes('date')
                ) {
                    // Get unique values, applying translations if needed
                    var uniqueVals = [...new Set(data.map(row => {
                        var val = row[col.data];
                        // Translate if this is Role, Country, Gender, or Cause of Death
                        if ((col.data === 'Role' || col.data === 'Country' || col.data === 'Gender' || col.data === 'סיבת המוות') && val && translations[val]) {
                            return translations[val];
                        }
                        // Translate Residence values using location dictionary
                        if (col.data === 'Residence' && val && residenceTranslations[val]) {
                            return residenceTranslations[val];
                        }
                        return val;
                    }).filter(v => v))].sort();
                    // Check if values exist and their max length is reasonable
                    var maxLen = Math.max(...uniqueVals.map(v => v.length));
                    if (uniqueVals.length > 1 && uniqueVals.length < 50 && maxLen < 30) {
                        filterHtml += `<div style="display:inline-block; margin-left:15px; vertical-align:top; position:relative;">`;
                        filterHtml += `<button class="filter-button" data-filter="filter${idx}" style="padding:5px 10px; cursor:pointer;">${col.title} ▼</button>`;
                        filterHtml += `<div id="filter${idx}" class="filter-dropdown" style="display:none; position:absolute; z-index:1000; background:#fff; border:1px solid #ccc; padding:5px; min-width:150px; max-height:200px; overflow-y:auto; box-shadow:0 2px 5px rgba(0,0,0,0.2);">`;
                        filterHtml += `<div style="margin-bottom:5px; border-bottom:1px solid #ccc; padding-bottom:5px;">`;
                        filterHtml += `<button class="select-all-btn" data-filter="filter${idx}" style="margin-right:5px; padding:2px 8px; cursor:pointer;">All</button>`;
                        filterHtml += `<button class="clear-all-btn" data-filter="filter${idx}" style="padding:2px 8px; cursor:pointer;">Clear</button>`;
                        filterHtml += `</div>`;
                        uniqueVals.forEach(function(val) {
                            var escapedVal = val.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
                            filterHtml += `<label style="display:block; white-space:nowrap;"><input type="checkbox" class="filter-checkbox" data-column="${idx}" value="${escapedVal}" data-original-value="${escapedVal}" checked> ${val}</label>`;
                        });
                        filterHtml += `</div></div>`;
                    }
                }
            });
            filterHtml += `</div><div id="date-row" style="margin-top:10px;">`;
            columns.forEach(function(col, idx) {
                if (col.data.toLowerCase().includes('date')) {
                    filterHtml += `<label>${col.title} from <input type="date" id="minDate${idx}" value="${oct7Str}"> to <input type="date" id="maxDate${idx}" value="${todayStr}"></label> `;
                }
            });
            filterHtml += `</div><div id="download-row" style="margin-top:10px;">
                <button id="downloadFullXLSX">Download full table (XLSX)</button>
                <button id="downloadFilteredXLSX">Download filtered data (XLSX)</button>
            </div>`;
            $("#filters").html(filterHtml);

            // Filtering logic
                        // XLSX download logic
                        function exportToXLSX(rows, cols, filename) {
                            var wb = XLSX.utils.book_new();
                            var ws_data = [cols.map(c => c.title)];
                            rows.forEach(function(row) {
                                ws_data.push(cols.map(c => {
                                    var cellData = row[c.data] || '';
                                    // Convert Age to integer
                                    if (c.data === 'Age' && cellData) {
                                        var ageNum = parseInt(cellData);
                                        cellData = isNaN(ageNum) ? '' : ageNum.toString();
                                    }
                                    // Apply translations same as display
                                    if (c.data === 'Role' && cellData && translations[cellData]) {
                                        cellData = translations[cellData];
                                    }
                                    if (c.data === 'Country' && cellData && translations[cellData]) {
                                        cellData = translations[cellData];
                                    }
                                    if (c.data === 'Gender' && cellData && translations[cellData]) {
                                        cellData = translations[cellData];
                                    }
                                    if (c.data === 'סיבת המוות' && cellData && translations[cellData]) {
                                        cellData = translations[cellData];
                                    }
                                    if (c.data === 'Residence' && cellData && residenceTranslations[cellData]) {
                                        cellData = residenceTranslations[cellData];
                                    }
                                    return cellData;
                                }));
                            });
                            var ws = XLSX.utils.aoa_to_sheet(ws_data);
                            XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
                            XLSX.writeFile(wb, filename);
                        }
                        // Load SheetJS
                        if (typeof XLSX === 'undefined') {
                            var xlsxScript = document.createElement('script');
                            xlsxScript.src = "https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js";
                            document.head.appendChild(xlsxScript);
                        }
                        $('#downloadFullXLSX').on('click', function() {
                            exportToXLSX(data, columns, 'oct7database_full.xlsx');
                        });
                        $('#downloadFilteredXLSX').on('click', function() {
                            var filteredIndexes = table.rows({ filter: 'applied' }).indexes().toArray();
                            var filteredRows = filteredIndexes.map(function(idx) { return data[idx]; });
                            exportToXLSX(filteredRows, columns, 'oct7database_filtered.xlsx');
                        });
            
            // Variable to store selected pid for filtering
            var selectedPid = null;
            
            // Custom filter function for exact pid match
            $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
                if (selectedPid === null) {
                    return true; // No pid filter active
                }
                var rowPid = data[pidColumnIndex]; // Use the pid column index
                return rowPid === selectedPid;
            });
            
            // Row click handler - log pid and filter to show only this row
            $('#oct7table tbody').on('click', 'tr', function() {
                var rowIndex = table.row(this).index();
                if (rowIndex !== undefined && data[rowIndex]) {
                    var pid = data[rowIndex].pid;
                    console.log('Selected PID:', pid);
                    
                    // Set the selected pid and redraw to filter
                    selectedPid = pid;
                    table.draw();
                }
            });

            // Check for single row after filtering
            table.on('draw', function() {
                var info = table.page.info();
                var visibleRows = table.rows({ filter: 'applied' }).data().length;
                // Only show map if there's exactly 1 row AND selectedPid is set (intentional selection)
                if (visibleRows === 1 && selectedPid !== null) {
                    var rowIndex = table.rows({ filter: 'applied' }).indexes()[0];
                    if (rowIndex !== undefined && data[rowIndex]) {
                        var pid = data[rowIndex].pid;
                        console.log('Single row PID:', pid);
                        
                        // Show map with this pid
                        $('#map-iframe').attr('src', 'locations.html?pid=' + pid);
                        $('#map-container').show();
                    }
                } else {
                    // Hide map when multiple rows visible or no intentional selection
                    $('#map-container').hide();
                }
            });

            // Free search bar
            $('#globalSearch').on('input', function() {
                table.search(this.value).draw();
            });

            // Reset button - clear all filters
            $('#resetButton').on('click', function() {
                // Clear selected pid filter
                selectedPid = null;
                
                // Clear global search
                $('#globalSearch').val('');
                table.search('').columns().search('').draw();
                
                // Check all checkboxes (show all values)
                $('.filter-checkbox').prop('checked', true);
                
                // Reset date filters to defaults
                var todayStr = new Date().toISOString().slice(0,10);
                var oct7Str = '2023-10-07';
                columns.forEach(function(col, idx) {
                    if (col.data.toLowerCase().includes('date')) {
                        $(`#minDate${idx}`).val(oct7Str);
                        $(`#maxDate${idx}`).val(todayStr);
                    }
                });
                
                // Hide the map
                $('#map-container').hide();
                
                // Redraw table
                table.draw();
            });

            // Toggle filter dropdown visibility
            $('.filter-button').on('click', function(e) {
                e.stopPropagation();
                var filterId = $(this).data('filter');
                var $dropdown = $('#' + filterId);
                
                // Close all other dropdowns
                $('.filter-dropdown').not($dropdown).hide();
                
                // Toggle this dropdown
                $dropdown.toggle();
            });

            // Close dropdowns when clicking outside
            $(document).on('click', function(e) {
                if (!$(e.target).closest('.filter-dropdown, .filter-button').length) {
                    $('.filter-dropdown').hide();
                }
            });

            // Select All button
            $('.select-all-btn').on('click', function(e) {
                e.stopPropagation();
                var filterId = $(this).data('filter');
                $('#' + filterId + ' .filter-checkbox').prop('checked', true).first().trigger('change');
            });

            // Clear All button
            $('.clear-all-btn').on('click', function(e) {
                e.stopPropagation();
                var filterId = $(this).data('filter');
                $('#' + filterId + ' .filter-checkbox').prop('checked', false).first().trigger('change');
            });

            // Store filter states for each column
            var columnFilters = {};
            columns.forEach(function(col, idx) {
                columnFilters[idx] = null; // null means all values allowed
            });

            // Custom search function for multi-select filters
            $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
                for (var colIdx in columnFilters) {
                    var allowedValues = columnFilters[colIdx];
                    if (allowedValues !== null && allowedValues.length > 0) {
                        var cellValue = data[colIdx];
                        // Apply translation if needed for comparison
                        var colData = columns[colIdx].data;
                        if ((colData === 'Role' || colData === 'Country' || colData === 'Gender' || colData === 'סיבת המוות') && cellValue && translations[cellValue]) {
                            cellValue = translations[cellValue];
                        }
                        if (colData === 'Residence' && cellValue && residenceTranslations[cellValue]) {
                            cellValue = residenceTranslations[cellValue];
                        }
                        if (!allowedValues.includes(cellValue)) {
                            return false;
                        }
                    }
                }
                return true;
            });

            // Helper function to decode HTML entities
            function decodeHtmlEntities(str) {
                var txt = document.createElement("textarea");
                txt.innerHTML = str;
                return txt.value;
            }

            columns.forEach(function(col, idx) {
                // Multi-select checkbox filter
                $(`#filter${idx} .filter-checkbox`).on('change', function() {
                    // Get all checked values for this column
                    var checkedValues = [];
                    $(`#filter${idx} .filter-checkbox:checked`).each(function() {
                        // Decode HTML entities from the value attribute
                        checkedValues.push(decodeHtmlEntities($(this).val()));
                    });
                    
                    // Update filter state
                    if (checkedValues.length === 0) {
                        // No values selected, filter to show nothing
                        columnFilters[idx] = [];
                    } else if (checkedValues.length === $(`#filter${idx} .filter-checkbox`).length) {
                        // All values selected, no filter needed
                        columnFilters[idx] = null;
                    } else {
                        // Some values selected
                        columnFilters[idx] = checkedValues;
                    }
                    
                    table.draw();
                });
                // Date range filter
                if (col.data.toLowerCase().includes('date')) {
                    $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
                        var min = $(`#minDate${idx}`).val();
                        var max = $(`#maxDate${idx}`).val();
                        var dateStr = data[idx];
                        if (!dateStr) return true;
                        var date = new Date(dateStr);
                        if ((min && date < new Date(min)) || (max && date > new Date(max))) return false;
                        return true;
                    });
                    $(`#minDate${idx}, #maxDate${idx}`).on('change', function() {
                        table.draw();
                    });
                }
            });
        }
    });
    }
    </script>
</body>
</html>
